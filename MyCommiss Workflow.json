{
  "name": "MyCommiss Workflow",
  "nodes": [
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n  DATE(o.order_date)   AS sale_date,\n  o.order_id,\n  c.name               AS customer_name,\n  ct.cat_name          AS cat_name,\n  p.p_name             AS product_name,\n  od.quantity          AS qty,\n  od.price             AS unit_price,\n  od.subtotal          AS subtotal,\n  o.payment_status     AS payment_status,\n  o.payment_method     AS payment_method,\n  o.order_status       AS shipping_status\nFROM orders o\nJOIN customers c       ON o.customer_id = c.customer_id\nJOIN order_details od  ON o.order_id = od.order_id\nJOIN product p         ON od.p_id = p.p_id\nJOIN category ct       ON p.cat_id = ct.cat_id\nWHERE DATE(o.order_date) = DATE_SUB(CURDATE(), INTERVAL 1 DAY)\nORDER BY o.order_id, od.id;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        0,
        176
      ],
      "id": "34ba0a88-4113-4945-81bd-e10e9491b9b7",
      "name": "Execute a SQL query",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "JBTP6ufZQoCmYc8K",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1tdmtxnrDUllNzewTxA8Xdc6BrIUH0teCFHJEVoU84sw",
          "mode": "list",
          "cachedResultName": "MyCommiss",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1tdmtxnrDUllNzewTxA8Xdc6BrIUH0teCFHJEVoU84sw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 931964946,
          "mode": "list",
          "cachedResultName": "Order",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1tdmtxnrDUllNzewTxA8Xdc6BrIUH0teCFHJEVoU84sw/edit#gid=931964946"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "order_detail_id"
          ],
          "schema": [
            {
              "id": "order_detail_id",
              "displayName": "order_detail_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sale_date",
              "displayName": "sale_date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "order_id",
              "displayName": "order_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "customer_name",
              "displayName": "customer_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "customer_phone",
              "displayName": "customer_phone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shipping_address",
              "displayName": "shipping_address",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cat_name",
              "displayName": "cat_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "product_name",
              "displayName": "product_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "qty",
              "displayName": "qty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "unit_price",
              "displayName": "unit_price",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "subtotal",
              "displayName": "subtotal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "payment_status",
              "displayName": "payment_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "payment_method",
              "displayName": "payment_method",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shipping_status",
              "displayName": "shipping_status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        208,
        16
      ],
      "id": "95acbbca-f504-4ced-a0cf-55d44cced921",
      "name": "Append or update row in sheet1",
      "credentials": {
        "googleApi": {
          "id": "MEjPFhTSowgWJ5hO",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let sale_date = null;\nlet paid_total = 0;\nlet unpaid_total = 0;\nlet ordersMap = {};\n\n// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (Asia/Bangkok) ‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á ‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á timezone ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á\nconst nowBkk = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Bangkok' }));\nnowBkk.setDate(nowBkk.getDate() - 1);\nconst yesterdayText = nowBkk.toLocaleDateString('th-TH');\n\nconst sheet_url = \"https://docs.google.com/spreadsheets/d/1tdmtxnrDUllNzewTxA8Xdc6BrIUH0teCFHJEVoU84sw/edit?usp=sharing\";\n\n// items = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å node ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô n8n (‡πÅ‡∏ï‡πà‡∏•‡∏∞ item = 1 row)\nfor (const item of items) {\n  const j = item.json;\n\n  sale_date = sale_date || j.sale_date;\n  const amount = Number(j.subtotal || 0);\n\n  if (j.payment_status === '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß') paid_total += amount;\n  else unpaid_total += amount;\n\n  // ===== ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (COD = ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î) =====\n  let paymentMethodText = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';\n  if (j.payment_method === 'COD') paymentMethodText = 'üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î';\n  else if (j.payment_method === 'QR') paymentMethodText = 'üì≤ ‡πÇ‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£';\n\n  if (!ordersMap[j.order_id]) {\n    ordersMap[j.order_id] = {\n      customer_name: j.customer_name,\n      payment_status: j.payment_status,\n      payment_method: paymentMethodText,     // << ‡πÄ‡∏û‡∏¥‡πà‡∏°\n      total_amount: 0,\n      categories: {}\n    };\n  }\n\n  const catName = j.cat_name || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';\n  if (!ordersMap[j.order_id].categories[catName]) {\n    ordersMap[j.order_id].categories[catName] = [];\n  }\n\n  ordersMap[j.order_id].categories[catName].push(`      ‚ó¶ ${j.product_name}\\n(‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${j.qty} ‡∏ä‡∏¥‡πâ‡∏ô)`);\n  ordersMap[j.order_id].total_amount += amount;\n}\n\n// ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå\nlet detail_lines = [];\nfor (const order_id in ordersMap) {\n  const order = ordersMap[order_id];\n\n  let categorySections = [];\n  for (const cat in order.categories) {\n    categorySections.push(`   üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${cat}\\n${order.categories[cat].join('\\n')}`);\n  }\n\n  detail_lines.push(\n`üÜî ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: #${order_id}\nüë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ‡∏Ñ‡∏∏‡∏ì ${order.customer_name}\n${categorySections.join('\\n')}\nüí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${order.total_amount.toLocaleString(undefined, { minimumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó\nüìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ${order.payment_status === '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? '‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‚è≥ ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞'}\nüí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞: ${order.payment_method}`\n  );\n}\n\n// ===== ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ç‡∏≠: unshift ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô =====\nlet all_messages = [];\n\nall_messages.unshift(\n`‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì\n        üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô\n‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${yesterdayText}\n\nüí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${(paid_total + unpaid_total).toLocaleString(undefined, { minimumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó\n----------------------------------\n‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß: ${paid_total.toLocaleString(undefined, { minimumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó\n‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢: ${unpaid_total.toLocaleString(undefined, { minimumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó\n\nüìÅ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:\nüîó ${sheet_url}\n\n‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö üòé`\n);\n\n// ‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á (‡∏ó‡∏µ‡∏•‡∏∞ 5)\nfor (let i = 0; i < detail_lines.length; i += 5) {\n  const chunk = detail_lines.slice(i, i + 5);\n\n  all_messages.push(\n`üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (${i + 1}-${Math.min(i + 5, detail_lines.length)})\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n${chunk.join('\\n------------------------------\\n')}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`\n  );\n}\n\n// ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏≤‡∏¢ items ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Split Out ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠\nreturn all_messages.map(msg => ({ json: { line_text: msg } }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        96
      ],
      "id": "0c16c2fa-683e-4515-82f6-ab7ce0ea7a18",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"U207465dbcb10b31129ea7c68a9cf2ccd\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.line_text.replace(/\\n/g, '\\\\n') }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1136,
        112
      ],
      "id": "73d35bfa-6018-4242-8844-e3395777eaf4",
      "name": "HTTP Request1",
      "credentials": {
        "httpBearerAuth": {
          "id": "4mDmMKndGIStlP5J",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT p.p_name, c.cat_name, p.p_stock\nFROM product p\nJOIN category c ON p.cat_id = c.cat_id\nWHERE p.p_stock < 6;",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        1104,
        432
      ],
      "id": "13197994-dd10-4693-9e83-04ff7e0081c9",
      "name": "Execute a SQL query1",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "JBTP6ufZQoCmYc8K",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "line_text",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        656,
        96
      ],
      "id": "c2fca5fd-ae84-4b07-811d-b1467704a2ab",
      "name": "Split Out"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "e16aa7fb-6640-4165-9e19-d5f0f3526228",
              "leftValue": "={{ Object.keys($json).length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        208,
        176
      ],
      "id": "fc18f644-5b68-4eb9-a186-f4d0014cf1df",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f24fb7a4-4a58-40e4-9526-c298b5f36a17",
              "name": "=line_text",
              "value": "=‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì\\n        üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô\\n‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ \n  (() => {\n    const nowBkk = new Date(\n      new Date().toLocaleString('en-US', { timeZone: 'Asia/Bangkok' })\n    );\n    nowBkk.setDate(nowBkk.getDate() - 1);\n    return nowBkk.toLocaleDateString('th-TH');\n  })()\n}}\n \\n‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö\\n‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏î‡∏µ ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ----------------------------------\\nüìÅ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà :\\nüîó https://docs.google.com/spreadsheets/d/1tdmtxnrDUllNzewTxA8Xdc6BrIUH0teCFHJEVoU84sw/edit?usp=sharing",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        448,
        256
      ],
      "id": "f3e86a93-027f-4f04-b9da-00284ade2964",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"U207465dbcb10b31129ea7c68a9cf2ccd\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.line_text.replace(/\\n/g, '\\\\n') }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        656,
        256
      ],
      "id": "b3d58608-e123-4011-93b3-e20e2e1c9ead",
      "name": "HTTP Request",
      "credentials": {
        "httpBearerAuth": {
          "id": "4mDmMKndGIStlP5J",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 9
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -240,
        96
      ],
      "id": "01964def-72d1-46c3-9ee0-86d019927a7f",
      "name": "Schedule Trigger",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "66d95e8e-1f33-469d-a401-5b1d6fa4c766",
              "leftValue": "={{ Object.keys($json).length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1296,
        432
      ],
      "id": "4c352d15-ac25-4655-8a2a-d644ca7687ca",
      "name": "If1"
    },
    {
      "parameters": {
        "jsCode": "if (items.length === 0) return [];\n\n// 1. ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà\nlet categoryMap = {};\n\nfor (const item of items) {\n  const p = item.json;\n  const catName = p.cat_name || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';\n  \n  if (!categoryMap[catName]) {\n    categoryMap[catName] = [];\n  }\n  // ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏î‡πà‡∏ô‡∏ä‡∏±‡∏î\n  categoryMap[catName].push(`   ‚ó¶ ${p.p_name}\\n     ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ‚ö†Ô∏è ${p.p_stock} ‡∏ä‡∏¥‡πâ‡∏ô`);\n}\n// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢ (Asia/Bangkok) ‡πÅ‡∏ö‡∏ö‡∏ô‡∏¥‡πà‡∏á ‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á timezone ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á\nconst nowBkk = new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Bangkok' }));\nnowBkk.setDate(nowBkk.getDate() - 1);\nconst yesterdayText = nowBkk.toLocaleDateString('th-TH');\n\n\n// 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡πÄ‡∏≠‡∏≤‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô\nlet reportLines = [];\nfor (const catName in categoryMap) {\n  reportLines.push(`üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${catName}\\n${categoryMap[catName].join('\\n\\n')}`);\n}\n\n// 3. ‡πÅ‡∏ö‡πà‡∏á‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î‡πÜ (‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡∏∞ 5 ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô)\nlet all_messages = [];\n// ‡∏õ‡∏£‡∏±‡∏ö Header ‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢\nconst header = \n`‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì\n          ‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥! \n‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${yesterdayText}`\n\nfor (let i = 0; i < reportLines.length; i += 5) {\n  const chunk = reportLines.slice(i, i + 5);\n  all_messages.push(\n`${header}\n\n${chunk.join('\\n------------------------------\\n')}\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö! üì¶`\n  );\n}\n\nreturn all_messages.map(msg => {\n  return { json: { line_text: msg } };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1568,
        336
      ],
      "id": "cbb06c12-1699-4e38-b9d7-e87ad8672acd",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "fieldToSplitOut": "line_text",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1776,
        336
      ],
      "id": "5d416dec-70b6-4b86-8747-34bebc832ee6",
      "name": "Split Out1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"U207465dbcb10b31129ea7c68a9cf2ccd\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.line_text.replace(/\\n/g, '\\\\n') }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2240,
        352
      ],
      "id": "d1ce6d02-7b68-4fbe-8080-06bba5fca62b",
      "name": "HTTP Request2",
      "credentials": {
        "httpBearerAuth": {
          "id": "4mDmMKndGIStlP5J",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"U207465dbcb10b31129ea7c68a9cf2ccd\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": \"{{ $json.line_text.replace(/\\n/g, '\\\\n') }}\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1776,
        512
      ],
      "id": "e926bcbf-e49f-4e1a-a10e-d95bb21bd895",
      "name": "HTTP Request3",
      "credentials": {
        "httpBearerAuth": {
          "id": "4mDmMKndGIStlP5J",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f24fb7a4-4a58-40e4-9526-c298b5f36a17",
              "name": "line_text",
              "value": "=‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì\\n          üì¶ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢\\n‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ\\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{ \n  (() => {\n    const nowBkk = new Date(\n      new Date().toLocaleString('en-US', { timeZone: 'Asia/Bangkok' })\n    );\n    nowBkk.setDate(nowBkk.getDate() - 1);\n    return nowBkk.toLocaleDateString('th-TH');\n  })()\n}}\n\\n‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡πà‡∏≥‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà \\n‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÅ‡∏ô‡πà‡∏ô‡πÜ ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ñ‡∏£‡∏±‡∏ö!\\n‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏° üòé",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1568,
        512
      ],
      "id": "bb1fd2d4-a4b1-4488-9500-9e1a5bfe5ba6",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        896,
        96
      ],
      "id": "ffdf9136-6271-4fc4-91f5-098a8904b4c2",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2000,
        336
      ],
      "id": "02e08abb-db9a-478c-bc21-73a31aef0c3d",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n  od.id AS order_detail_id,  -- ‚úÖ ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô Key Column (‡∏ñ‡∏≤‡∏ß‡∏£)\n  DATE(o.order_date) AS sale_date,\n  o.order_id,\n  c.name AS customer_name,\n  c.phone AS customer_phone,\n  c.address AS shipping_address,\n  ct.cat_name AS cat_name,\n  p.p_name AS product_name,\n  od.quantity AS qty,\n  od.price AS unit_price,\n  od.subtotal AS subtotal,\n  o.payment_status AS payment_status,\n  o.payment_method AS payment_method,\n  o.order_status AS shipping_status\nFROM orders o\nJOIN customers c  ON o.customer_id = c.customer_id\nJOIN order_details od ON o.order_id = od.order_id\nJOIN product p    ON od.p_id = p.p_id\nJOIN category ct  ON p.cat_id = ct.cat_id\nORDER BY o.order_date, o.order_id, od.id;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        0,
        16
      ],
      "id": "cce8b4a6-9b80-4929-9111-317821434abd",
      "name": "Execute a SQL query2",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "JBTP6ufZQoCmYc8K",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "months",
              "triggerAtHour": 9,
              "triggerAtMinute": 1
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -256,
        512
      ],
      "id": "8d2250af-1955-4658-ad10-227bda855db2",
      "name": "Schedule Trigger1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    p.p_id,\n    p.p_name AS product_name,\n    ct.cat_name AS category_name,\n    SUM(od.quantity) AS total_qty_sold\nFROM orders o\nJOIN order_details od ON o.order_id = od.order_id\nJOIN product p ON od.p_id = p.p_id\nJOIN category ct ON p.cat_id = ct.cat_id\nWHERE \n    o.order_date >= DATE_SUB(DATE_FORMAT(CURDATE(), '%Y-%m-01'), INTERVAL 1 MONTH)\n    AND o.order_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')\n    AND o.payment_status = '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß'\nGROUP BY \n    p.p_id,\n    p.p_name,\n    ct.cat_name\nORDER BY total_qty_sold DESC;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -48,
        512
      ],
      "id": "38678e98-991a-4516-88d7-7205fcd07328",
      "name": "Execute a SQL query3",
      "credentials": {
        "mySql": {
          "id": "JBTP6ufZQoCmYc8K",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let totalQtyAll = 0;\n\n// ===== ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ó‡∏¢) =====\nconst nowBkk = new Date(\n  new Date().toLocaleString('en-US', { timeZone: 'Asia/Bangkok' })\n);\n\nconst firstDayThisMonth = new Date(\n  nowBkk.getFullYear(),\n  nowBkk.getMonth(),\n  1\n);\n\nconst firstDayLastMonth = new Date(firstDayThisMonth);\nfirstDayLastMonth.setMonth(firstDayLastMonth.getMonth() - 1);\n\nconst monthText = firstDayLastMonth.toLocaleDateString('th-TH', {\n  year: 'numeric',\n  month: 'long'\n});\n\n// ===== ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å =====\nconst top5 = items.slice(0, 5);\n\n// ===== ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Top 5) =====\nfor (const item of top5) {\n  totalQtyAll += Number(item.json.total_qty_sold || 0);\n}\n\n// ===== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° =====\nlet detail_lines = top5.map((item, index) => {\n  const category =\n    item.json.category_name ||\n    item.json.cat_name ||\n    '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';\n\n  return `${index + 1}. üèÜ ${item.json.product_name}\n   üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${category}\n   üì¶ ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ: ${Number(item.json.total_qty_sold).toLocaleString()} ‡∏ä‡∏¥‡πâ‡∏ô`;\n});\n\nlet message = `‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì\n          üìä 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ\n‚îó‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îõ\nüìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${monthText}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n${detail_lines.join('\\n------------------------------\\n')}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;\n\nreturn [\n  {\n    json: {\n      line_text: message\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        160,
        512
      ],
      "id": "f2c2222e-ff32-4a7d-91e1-8889feaaea24",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"to\": \"U207465dbcb10b31129ea7c68a9cf2ccd\",\n  \"messages\": [\n    {\n      \"type\": \"text\",\n      \"text\": {{ JSON.stringify($json.line_text) }}\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.4,
      "position": [
        368,
        512
      ],
      "id": "6a0e3b9f-531a-4fac-ae75-69ba021b8248",
      "name": "HTTP Request4",
      "credentials": {
        "httpBearerAuth": {
          "id": "4mDmMKndGIStlP5J",
          "name": "Bearer Auth account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -240,
        -304
      ],
      "id": "e2397b4a-f34a-42c9-97a0-619bdbab81b0",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT name, email, subscribe\nFROM customers\nWHERE subscribe = 1;",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -32,
        -304
      ],
      "id": "65f03930-5e57-4294-8585-10b2e9a46e16",
      "name": "Execute a SQL query4",
      "credentials": {
        "mySql": {
          "id": "JBTP6ufZQoCmYc8K",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f83d6cf2-366e-4a7e-aa20-853314b568c2",
              "name": "subject",
              "value": "‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ üéâ",
              "type": "string"
            },
            {
              "id": "679ed58a-d2f8-4e95-9d39-66d7d9e56c31",
              "name": "html",
              "value": "=<h2>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì {{$json[\"name\"]}}</h2> <p>‡∏Ç‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p> <ul> <li>‡∏•‡∏î 20% ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î</li> <li>‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö 1,000 ‡∏ö‡∏≤‡∏ó ‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ</li> </ul> <p>‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡∏ï‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        176,
        -304
      ],
      "id": "5f86d65f-3c54-43b5-914e-00626e698982",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "fromEmail": "67010974018@msu.ac.th",
        "toEmail": "={{ $json.email }}",
        "subject": "={{ $json.subject }}",
        "html": "={{ $json.html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        384,
        -304
      ],
      "id": "ae7d1769-7fe6-42b4-91c9-9a78f2c08db6",
      "name": "Send an Email",
      "webhookId": "b83a60ba-b7b2-4eb6-ad3b-809499a50139",
      "credentials": {
        "smtp": {
          "id": "UowHqKwKgvYyBirp",
          "name": "SMTP account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Execute a SQL query1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          },
          {
            "node": "Execute a SQL query2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Execute a SQL query1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query2": {
      "main": [
        [
          {
            "node": "Append or update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Execute a SQL query3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query3": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Execute a SQL query4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query4": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Send an Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "timezone": "Asia/Bangkok",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "9ba1f9c3-5ee3-4cef-ac8f-7dbdaa165a5d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "897fa275083eef3a820e0b41d7de24b01122dca0848a5de4d3e67b1846c14d72"
  },
  "id": "HVZL3YcAlSmUtlsa",
  "tags": []
}